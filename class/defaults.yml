parameters:
  mimir:
    =_metadata:
      multi_instance: true
      multi_tenant: true

    name: ${_instance}
    namespace:
      name: syn-mimir
      create: true
      metadata: {}

    secrets:
      mimir-bucket-secret:
        stringData:
          S3_ACCESS_KEY_ID: null
          S3_SECRET_ACCESS_KEY: null
          S3_ENDPOINT: null

    charts:
      mimir-distributed:
        source: https://grafana.github.io/helm-charts
        version: v4.3.0

    alerts:
      additionalRules: {}
      patchRules:
        ignoreNames: []
        patches: {}

    s3:
      bucketPrefix: ${_instance}

    config:
      zoneAwareReplication: true
      nodeSelector: {}
      storageClass: ''
      objectClass: ''
      # Allows overriding the resolver for the mimir-distributed chart, if using nginx as the frontend.
      nginxResolverOverride: ''

    # --- Components configuration ---------------------------------------------

    # The defaults are close to the upstream defaults, with HA enabled, and the bucket secret added.
    # Replicas are taken from the `small.yaml` recommended production values.
    # See parameters.adoc for links to the upstream sizing guidelines.

    components:
      querier:
        replicas: 2
        resources:
          requests:
            cpu: 2
            memory: 4Gi
          limits:
            memory: 5.6Gi
      queryFrontend:
        replicas: 1
        resources:
          requests:
            cpu: 2
            memory: 2Gi
          limits:
            memory: 2.8Gi
      storeGateway:
        replicas: 1
        persistentVolume:
          size: 20Gi
        resources:
          requests:
            cpu: 1
            memory: 1.5Gi
          limits:
            memory: 2.1Gi

      distributor:
        replicas: 3
        resources:
          requests:
            cpu: 2
            memory: 4Gi
          limits:
            memory: 5.7Gi
      ingester:
        replicas: 4
        persistentVolume:
          size: 50Gi
        resources:
          requests:
            cpu: 3.5
            memory: 8Gi
          limits:
            memory: 12Gi

      compactor:
        replicas: 1
        persistentVolume:
          size: 50Gi
        resources:
          requests:
            cpu: 1
            memory: 1.5Gi
          limits:
            memory: 2.1Gi
      overridesExporter:
        replicas: 1
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            memory: 128Mi
      gateway:
        replicas: 3
        resources:
          requests:
            cpu: 1
            memory: 512Mi
          limits:
            memory: 731Mi

      alertmanager:
        replicas: 3
        resources:
          requests:
            cpu: 1
            memory: 1Gi
          limits:
            memory: 1.4Gi
      queryScheduler:
        replicas: 2
        resources: {}
      ruler:
        replicas: 2
        resources:
          requests:
            cpu: 1
            memory: 2Gi
          limits:
            memory: 2.8Gi
      rolloutOperator:
        replicas: 1
        resources: {}

    caches:
      chunks:
        enabled: true
        replicas: 2
        resources:
          requests:
            cpu: 500m
            memory: 4Gi
          limits:
            memory: 4Gi
      index:
        enabled: true
        replicas: 3
        resources:
          requests:
            cpu: 500m
            memory: 1500Mi
          limits:
            memory: 1500Mi
      metadata:
        enabled: true
        replicas: 1
        resources: {}
      results:
        enabled: true
        replicas: 1
        resources: {}

    # --- Helm configuration ---------------------------------------------------

    helm_values:
      minio:
        enabled: false
